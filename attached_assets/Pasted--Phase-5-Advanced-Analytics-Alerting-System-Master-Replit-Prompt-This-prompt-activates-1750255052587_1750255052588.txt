ğŸš¨ **Phase 5: Advanced Analytics + Alerting System â€” Master Replit Prompt**

This prompt activates the full fraud analytics & alert system for your Square AI fraud engine:

---

### âœ… GOAL

Implement real-time fraud analytics, alert streaming, and intelligent notification systems tied to Square webhook activity, AI fraud scores, and geo-location threat signals.

---

### ğŸ§  Master Prompt for Replit AI Agent

````bash
# ğŸ”§ PHASE 5: ADVANCED ANALYTICS + ALERTING SYSTEM (Replit AI Agent)
# Do NOT create duplicate components, files, or services.
# Must reuse: FraudDetectionEngine, ThreatMapService, fraud_log, threat_logs
# Output must be LIVE-USE READY, not mock/demo.

# âœ… STEP 1 â€” FRONTEND: Fraud Analytics Page (/admin/analytics)
- Create `client/src/pages/admin-analytics.tsx`
- Add:
  - ğŸ“ˆ Chart: Fraud Signals Over Time (Bar or Line using recharts)
  - ğŸ“Š Chart: Threat Score Distribution (Pie or Histogram)
  - â±ï¸ Widget: "Avg Detection Delay", "Top Attack Countries", "Total Alerts Today"
- Data sources:
  - GET `/api/fraud/stats`
  - GET `/api/threats/stats`
  - Reuse existing stats endpoints (donâ€™t recreate them)

# âœ… STEP 2 â€” BACKEND: Alert Engine
- Create `server/services/AlertDispatcher.ts`
- Responsibilities:
  - Evaluate fraud score + threat severity
  - If `score >= 85` or `proxyDetected === true`, send alert
  - Dispatch to: Slack, email (Mailgun), and in-app socket stream

- Accept config from `.env`:
  - `SLACK_WEBHOOK_URL`
  - `MAILGUN_API_KEY`
  - `ALERT_EMAIL_TO`
  - fallback if missing = console.warn

# âœ… STEP 3 â€” SOCKET.IO: Real-Time Alerts Feed
- Add new event namespace: `admin-alert-feed`
- On new fraud signal or threat log:
  - Emit `{ type: "fraud" | "geo-threat", score, summary, timestamp }`
- Frontend listens in `/admin/analytics` and displays real-time alert feed

# âœ… STEP 4 â€” Hook AlertDispatcher into FraudDetectionEngine + ThreatMapService
- After each `logFraudSignal()` or `logThreat()`, trigger:
  ```ts
  AlertDispatcher.dispatch({
    type: 'fraud',
    score: signal.score,
    summary: signal.reason,
    timestamp: signal.created_at,
  })
````

# âœ… STEP 5 â€” Bonus UX

* If fraud signals spike rapidly (3+ signals in 60 sec), add toast in UI
* If alert fails to send (missing key), store it in `unsent_alerts[]` (in memory only)

# â›”ï¸ RULES:

* Donâ€™t create new database tables unless explicitly told
* Reuse existing `fraud_log`, `threat_logs`, `socket`, and `/admin/*` routes
* All alert logic must be idempotent â€” no duplicates or resend loops

# âœ… FINAL CHECK

* Confirm analytics load with real data
* Real-time alerts appear without refresh
* Emails/Slack/web all show identical alert metadata
* Test 5+ fraud webhook events to validate streaming

# âœ… GO TIME â€” Begin Implementation

```

---

Say `ğŸ“¦ Drop Phase 5.5` when this is fully verified â€” and Iâ€™ll help you build **AI Digest Reports + Auto-Responder Engine** next.
```
